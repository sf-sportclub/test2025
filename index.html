<!doctype html>
<html lang="th">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>โหวตหลักสูตร</title>
<style>
  body { font-family: system-ui, sans-serif; margin: 20px; }
  .box { max-width: 520px; margin: auto; border: 1px solid #ddd; border-radius: 12px; padding: 16px; }
  label { display:block; margin-top: 10px; }
  input, select { width:100%; padding:10px; margin-top:6px; }
  .row { display:flex; gap:10px; }
  .row > * { flex:1; }
  button { margin-top:14px; padding:10px 14px; }
  .msg { margin-top:10px; color:#0a7a2e; }
  .err { color:#b00020; }
</style>

<div class="box">
  <h2>หลักสูตรที่อยากให้จัด</h2>

  <form id="f">
    <label>รหัสพนักงาน
      <input id="employeeId" required>
    </label>

    <label>แผนก
      <select id="department" required>
        <option value="" selected disabled>เลือกแผนก</option>
        <option>Human Resources</option>
        <option>Information Technology</option>
        <option>Marketing</option>
        <option>Operation</option>
        <option>Project</option>
        <!-- เติมรายการอื่นได้ -->
      </select>
    </label>

    <label>ผลโหวต
      <select id="vote" required>
        <option value="" selected disabled>เลือกหัวข้อ</option>
        <option>Work life Balance</option>
        <option>AI Presentation</option>
        <option>Leadership</option>
        <option>Communication</option>
      </select>
    </label>

    <button type="submit">ส่งผลโหวต</button>
    <div id="msg" class="msg"></div>
  </form>
</div>

<script>
  // วางลิงก์ /exec ของ Apps Script ที่ Deploy แล้ว
  const GAS_URL = 'https://script.google.com/macros/s/AKfycbwNwDM6g7DmneaVMFQ7XybrFbQ0bI1MulA-diqjaWpYMzGw91K2BdDUsSY87gj_f5eB/exec';

  const f   = document.getElementById('f');
  const msg = document.getElementById('msg');

  f.addEventListener('submit', async (e) => {
    e.preventDefault();
    msg.className = 'msg'; msg.textContent = 'กำลังส่ง...';

    const payload = {
      employeeId: document.getElementById('employeeId').value.trim(),
      department: document.getElementById('department').value,
      vote:       document.getElementById('vote').value
    };

    try {
      // no-cors + text/plain → ไม่เกิด preflight → GAS รับได้
      await fetch(GAS_URL, {
        method: 'POST',
        mode: 'no-cors',
        headers: { 'Content-Type': 'text/plain;charset=utf-8' },
        body: JSON.stringify(payload)
      });

      // หมายเหตุ: โหมด no-cors อ่านผลตอบกลับไม่ได้ → โชว์แบบ optimistic
      msg.className = 'msg'; 
      msg.textContent = 'ส่งผลโหวตเรียบร้อย ขอบคุณครับ!';
      f.reset();
    } catch (err) {
      msg.className = 'msg err';
      msg.textContent = 'ส่งไม่สำเร็จ กรุณาลองใหม่';
      console.error(err);
    }
  });
</script>
</html>
